(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,97923,(e,t,s)=>{t.exports=e.r(12455)},3366,e=>{"use strict";var t=e.i(92316),s=e.i(96040),n=e.i(97923);e.i(51383);var a=e.i(23933),i=e.i(65942),o=e.i(79239),c=e.i(45736),r=e.i(69620);function g({children:e}){let g=(0,n.useRouter)(),u=((0,s.useEffect)(()=>(a.authService.isAuthenticated()&&i.socketManager.connect(),()=>{i.socketManager.disconnect()}),[]),i.socketManager);return!function(){let e=(0,o.useAppDispatch)(),{user:t}=(0,o.useAppSelector)(e=>e.auth),{messagesByConversation:n}=(0,o.useAppSelector)(e=>e.messages);(0,s.useEffect)(()=>{if(t)return i.socketManager.onMessageReceived(t=>{let s=t.groupId||t.senderId;e((0,c.addMessage)({conversationId:s,message:t}))}),i.socketManager.onMessageSent(t=>{t.groupId||t.receiverId,e((0,c.updateMessage)(t))}),i.socketManager.onMessageEdit(t=>{e((0,c.updateMessage)(t))}),i.socketManager.onMessageDelete(({messageId:t})=>{Object.keys(n).forEach(s=>{e((0,c.removeMessage)({conversationId:s,messageId:t}))})}),i.socketManager.onTypingStart(({userId:s,groupId:n,receiverId:a})=>{if(s!==t.id){let t=n||a||s;e((0,c.setTyping)({conversationId:t,userId:s,isTyping:!0}))}}),i.socketManager.onTypingStop(({userId:s,groupId:n,receiverId:a})=>{if(s!==t.id){let t=n||a||s;e((0,c.setTyping)({conversationId:t,userId:s,isTyping:!1}))}}),()=>{}},[e,t,n])}(),!function(){let e=(0,o.useAppDispatch)(),{user:t}=(0,o.useAppSelector)(e=>e.auth),{activeConversationId:n}=(0,o.useAppSelector)(e=>e.ui);(0,s.useEffect)(()=>{if(t)return i.socketManager.onMessageReceived(t=>{let s=t.groupId||t.senderId;e((0,r.updateLastMessage)({conversationId:s,message:t})),s!==n&&e((0,r.incrementUnreadCount)(s))}),i.socketManager.onMessageSent(t=>{let s=t.groupId||t.receiverId;e((0,r.updateLastMessage)({conversationId:s,message:t}))}),i.socketManager.onTypingStart(({userId:s,groupId:n,receiverId:a})=>{s!==t.id&&e((0,r.setTypingStatus)({conversationId:n||a||s,isTyping:!0}))}),i.socketManager.onTypingStop(({userId:s,groupId:n,receiverId:a})=>{s!==t.id&&e((0,r.setTypingStatus)({conversationId:n||a||s,isTyping:!1}))}),i.socketManager.onUserOnline(({userId:t})=>{e((0,r.setOnlineStatus)({userId:t,isOnline:!0}))}),i.socketManager.onUserOffline(({userId:t})=>{e((0,r.setOnlineStatus)({userId:t,isOnline:!1}))}),()=>{}},[e,t,n])}(),(0,s.useEffect)(()=>{a.authService.isAuthenticated()||g.replace("/login")},[g]),(0,s.useEffect)(()=>{u.isConnected()&&console.log("WebSocket connected in main layout")},[u]),(0,t.jsx)("div",{className:"h-screen w-screen overflow-hidden bg-background",children:e})}e.s(["default",()=>g],3366)}]);